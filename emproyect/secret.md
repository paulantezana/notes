COMPARA ARCHIVOS: https://www.ddginc-usa.com/

181.224.226.108 // 192.168.33.206
aplicaciones
appEMMM$14

REPORTE
valorizador
Password$

= Parameters!DataBase.Value & ".Financiero.usp_rpt_CTB190_030300"

pAntezana@grupoValor.com
paan2021$



admin
123456

Frot
181.224.226.108:8080

FORTICLIENT
VPN: 181.224.226.106
PUERTO: 10443
USUARIO: AVargas
CLAVE: alva2018$
CLAVE: ]XsJC_hf9QSK

REMOTO: 192.168.33.206	


SELECT * FROM [Configuracion].[DiccionarioPantallaTabla]
SELECT * FROM [Configuracion].[DiccionarioPantallaCampo]
SELECT TOP 10 * FROM Auditoria.LogDeExcepciones ORDER BY Id DESC



6. Las pruebas serán realizadas con la empresa MINERCOBRE con ruc 20524561264.

-- Genera Diccionario
EXEC [Configuracion].[usp_GeneraDiccionario]
SELECT * FROM Configuracion.DiccionarioPantallaTabla WHERE Pantalla = 'FIN.CTB.075'
SELECT * FROM Configuracion.DiccionarioPantallaCampo WHERE Pantalla = 'FIN.CTB.075'


getEventListeners(window)

ACCESO CONCAR:
user: WPP
pass: WPP

CONCAR GRATIS
user: SIST
pass: NORTON

SUAGGER
http://192.168.33.206:8085/swagger/index.html


AHuaringa
123456


ACCESO --- VCM
user: ADMIN
pass: 290671


ACCESO --- MLC
user: ADMIN
pass: JAGUAR

IP:TOCHO
http://192.168.33.128:3911/

CLAVE -- SOL
20524561264
NTEMPARM
Mi27012021

20524561264
pAntezana@grupoValor.com
Nani$822B

RUTA REPORTE
\\192.168.33.206\ReportVisual

VER REPORTE:

http://192.168.33.206:8093/Report?id=CTB001&paramWhere=%28%28+%28Periodo+like+%27%25202307%25%27%29+and+%28Libro+%3D+%27OFICIAL%27%29+and+%28Moneda+%3D+%27PEN%27%29+%29%29&usuario=Admin&companias=27





EL MISMO SERVIDOR:


http://192.168.33.206/ReportServer/Pages/ReportViewer.aspx?%2fBackOffice%2fContabilidad%2fCTB001&rs:Command=Render




http://192.168.33.206/reports/browse/BackOffice/Contabilidad

Tengo lo siguiente datos:

Monto a pagar: 100 dolares

efectivo vale = 50%
tarjeta vale = 100%
cheque vale = 10%

Se pago
efectivo: 5 dolares
tarjeta: 100 dolares
cheque: 5 dolares

Como resultados tenemos
bueldo: 10 dolares
puntos acumulados segun el porcentaje: 95.5

Puedes predecir que operaciones se iso para que salga el resultado 95.5?




efectivo: 2.5
tarjeta: 100
cheque: 0.5

10
50%
+ 100% + 10%




INFORME
-- 030300: Query Correcto : hay 


CONCAR:
* DFECCOM2: Fecha Contable
* DFECVEN2: Fecha vencimiento
* DFECDOC2: Fecha documento

-- =========================================================================
-- CAJA    Y     BANCOS
✅ EXEC SP_GENERA_CAJA '0004', '2023', '04'
✅ [Reporte].[CTB190_010200]
-- Observacion:
    164-30008992 entidad axuliar Documento incorrecto en cuenta 104132

-- =========================================================================
-- INVENTARIO    Y     BALANCES
✅ EXEC [dbo].[PA_LE_BALANCE31] '0004', '2023', '04'
✅ EXEC [dbo].[PA_LE_BALANCE32] '0004', '2023', '04'
✅ EXEC [dbo].[PA_LE_BALANCE33] '0004', '2023', '04'
✅ EXEC [dbo].[PA_LE_BALANCE34] '0004', '2023', '04'
⚠️ EXEC [dbo].[PA_LE_BALANCE35] '0004', '2023', '04' -- EN BO falta actualizar TABLA - PLE Balance
⚠️ EXEC [dbo].[PA_LE_BALANCE36] '0004', '2023', '04' -- EN BO falta actualizar TABLA - PLE Balance
-- EXEC [dbo].[PA_LE_BALANCE37] '0004', '2023', '04' -- => EN Proviciones hay una tabla donde se almacena
-- EXEC [dbo].[PA_LE_BALANCE38] '0004', '2023', '04' -- => EN Proviciones hay una tabla donde se almacena
⚠️ EXEC [dbo].[PA_LE_BALANCE39] '0004', '2023', '04'
✅ EXEC [dbo].[PA_LE_BALANCE311] '0004', '2023', '04'
✅ EXEC [dbo].[PA_LE_BALANCE312] '0004', '2023', '04'
EXEC [dbo].[PA_LE_BALANCE313] '0004', '2023', '04'
EXEC [dbo].[PA_LE_BALANCE314] '0004', '2023', '04'

EXEC [dbo].[PA_LE_BALANCE315] '0004', '2023', '04'
EXEC [dbo].[PA_LE_BALANCE3161] '0004', '2023', '04'
EXEC [dbo].[PA_LE_BALANCE3162] '0004', '2023', '04'
EXEC [dbo].[PA_LE_BALANCE317] '0004', '2023', '04'
-- EXEC [dbo].[PA_LE_BALANCE318] '0004', '2023', '04' -- => otro metodo
-- EXEC [dbo].[PA_LE_BALANCE319] '0004', '2023', '04' -- => otro metodo
EXEC [dbo].[PA_LE_BALANCE320] '0004', '2023', '04'
-- EXEC [dbo].[PA_LE_BALANCE323] '0004', '2023', '04' -- => otro metodo
-- EXEC [dbo].[PA_LE_BALANCE324] '0004', '2023', '04' -- => otro metodo
-- EXEC [dbo].[PA_LE_BALANCE325] '0004', '2023', '04' -- => otro metodo


-- =========================================================================
-- DIARIO
EXEC SP_GENERA_DIARIO '0004', '2023', '01','01'
-- Detalle plan contable 

-- =========================================================================
-- MAYOR
EXEC SP_GENERA_DIARIO '0004', '2023', '01','01'


EXEC SP_REGISTRO_COMPRAS_REP '004','01','2023'
EXEC SP_GENERA_VENTAS '0004','2023','01'
EXEC SP_registroComprasNoDom_REP '0004','001','2023'


PA - boton apertura nuevo año
PA - (OK) revision de aprobaciones y alertas
<!-- PA - emitir PLE de 2023 y validarlo por el app PLE, menos RC RV -->
<!-- PA - revisar reporte de resumen de tesoreria -->
PA - (OK) Actualizar list de reporte, leer campo Configuracion.DiccionarioReporte.VistaOrden
PA - (OK) validar la creacion de un nuevo reporte personalizado para un nuevo usuario
PA - (OK) agregar en generadiccionario, script de insert o update de actualizacion de cuentas o cencos para los reportes 
PA - (OK) agregar campo con el nombre del reporte en - mantenimiento del configurador de cuentas


SELECT * FROM CT0032ANEX -- Anexos
SELECT * FROM CT0032CICA --
SELECT * FROM CT0032CIDE --
SELECT * FROM CT0032CONT21 --
SELECT * FROM CT0032DOCR -- Comprobante
SELECT * FROM CT0032PLEM -- Plan de cuentas
SELECT * FROM CT0032RUBM -- 
SELECT * FROM CT0032TAGE -- Tabla General
SELECT * FROM CT0032TRAE --
SELECT * FROM CTA04 -- Indice de tablas


""""""""""""""""""""""""""VSCODE
ELIMINAR LINEAS VACIAS: ^\s*$\n
ELIMINAR COMENTARIOS EN BLOQUE: /\*[\s\S]*?\*/
ELIMINAR COMENTARIOS DE UNA SOLA LINEA: --.*$















  CREATE TABLE Financiero.PLE_050100_xple_declarado (
      Ruc VARCHAR(20),
      UsuarioSol VARCHAR(50),
      RazonSocial NVARCHAR(300),
      LibroCodigo VARCHAR(10),
      LibroDescripcion NVARCHAR(128),
      LibroCodigoOportunidad VARCHAR(10),
      LibroIndicadorOperaciones VARCHAR(50),
      LibroIndicadorMoneda VARCHAR(50),
      LibroIndicadorAtraso VARCHAR(50),
      Periodo VARCHAR(20),
      Mes VARCHAR(20),

      ArchivoCodigo VARCHAR(10),
      ArchivoNombre NVARCHAR(255),
      ArchivoDescripcion NVARCHAR(MAX),
      ArchivoDirectorio NVARCHAR(MAX),
      ArchivoTamano INT,
      ArchivoHash NVARCHAR(255),

      SistemaOperativo NVARCHAR(50),
      MacAddress NVARCHAR(50),
      [IP] NVARCHAR(20),
      TransaccionNumero VARCHAR(20),
      TransaccionAnio VARCHAR(10),
      FechaRecepcion DATETIME,
      FechaValidacion DATETIME,
      CantidadLibros INT,
      TamanoDetalle INT,
      CantidadRegistrosE1 INT,
      CantidadRegistros INT,
      MontoDebeTotal  DECIMAL(18, 3),
      MontoHaberTotal  DECIMAL(18, 3),
      CantidadRegistrosDetalle INT,
      CantidadRegistrosE9 INT,
      CodigoHash NVARCHAR(255),
      CantidadRegistrosE8 INT,
      CodigoHashDetalle NVARCHAR(255),

      IdCompania INT,
      CodigoAnioPeriodo VARCHAR(32)
  );







<!-- exec [Financiero].[usp_generaRectificatoriaPLEDiario] 93991,'201901','Admin','CONCAR' -->



DROP TABLE IF EXISTS #ResumenTXTDeclarado;
DROP TABLE IF EXISTS #ResumenXPLEDeclarado;

SELECT
  TXT_IdCompania = LEFT(Compania,2)
  , TXT_CodigoAnioPeriodo = SUBSTRING(Compania,3,6)
  , TXT_SumaDebe = SUM (CONVERT(decimal(20,2), TRIM(C18_Debe)) )
  , TXT_SumaHaber = SUM (CONVERT(decimal(20,2), TRIM(C19_Haber)) )
  , TXT_CantidadE1 = SUM(IIF(C21_Estado = '1', 1, 0))
  , TXT_CantidadE8 = SUM(IIF(C21_Estado = '8', 1, 0))
  , TXT_CantidadE9 = SUM(IIF(C21_Estado = '9', 1, 0))
  , TXT_Cantidad = COUNT(1)
  INTO #ResumenTXTDeclarado
FROM Financiero.PLE_050100_txt_declarado
WHERE Compania LIKE '%2019%'
GROUP BY Compania


SELECT
  XPLE_IdCompania = IdCompania
  , XPLE_CodigoAnioPeriodo = CodigoAnioPeriodo
  , XPLE_MontoDebeTotal = MontoDebeTotal
  , XPLE_MontoHaberTotal = MontoHaberTotal
  , XPLE_CantidadRegistrosE1 = CantidadRegistrosE1
  , XPLE_CantidadRegistrosE8 = CantidadRegistrosE8
  , XPLE_CantidadRegistrosE9 = CantidadRegistrosE9
  , XPLE_CantidadRegistrosDetalle = CantidadRegistrosDetalle
  , XPLE_CantidadRegistros = CantidadRegistros
  INTO #ResumenXPLEDeclarado
FROM Financiero.PLE_050100_xple_declarado WHERE CodigoAnioPeriodo LIKE '%2019%'


SELECT
  *
   , Valido = IIF(   
        Dif_Debe           != 0   
        OR Dif_Haber       != 0    
        OR Dif_CantidadE1  != 0   
        OR Dif_CantidadE8  != 0   
        OR Dif_CantidadE9  != 0   
      ,'N','S'   
    )  
FROM (
  SELECT
    txt.*, xple.*
    , Dif_Debe        = txt.TXT_SumaDebe    - xple.XPLE_MontoDebeTotal
    , Dif_Haber       = txt.TXT_SumaHaber   - xple.XPLE_MontoHaberTotal
    , Dif_CantidadE1  = txt.TXT_CantidadE1  - xple.XPLE_CantidadRegistrosE1
    , Dif_CantidadE8  = txt.TXT_CantidadE8  - xple.XPLE_CantidadRegistrosE8
    , Dif_CantidadE9  = txt.TXT_CantidadE9  - xple.XPLE_CantidadRegistrosE9
  FROM #ResumenTXTDeclarado as txt
  FULL JOIN #ResumenXPLEDeclarado AS xple ON txt.TXT_IdCompania = xple.XPLE_IdCompania
      AND txt.TXT_CodigoAnioPeriodo = xple.XPLE_CodigoAnioPeriodo
) AS xp
ORDER BY 1, 2




SELECT C2_Cuo, C3_Correlativo FROM Financiero.PLE_050100_txt_declarado  WHERE Compania = '31201903' AND C21_Estado = '8'






















IMPORTAR TXTX



  DECLARE @Codigo VARCHAR(8) = '';   
  DECLARE @CodigoAnioPeriodo VARCHAR(8) = '';   
  DECLARE @Ubicacion VARCHAR(200) = '';   
  DECLARE @Archivo VARCHAR(200) = ''; 
  DECLARE @IdSunatElectronicoPeriodoVersion INT = 0;
  DROP TABLE IF EXISTS #SunatElectronicoRangoPeriodo;



SELECT   
  CodigoSunatElectronico = CodigoSunatElectronico   
  , CodigoAnioPeriodo = vap.CodigoAnioPeriodo   
  , Ubicacion = ISNULL(sv.UbicacionArchivo, '')   
  , Archivo = ISNULL(sv.Archivo, '')
  , IdSunatElectronicoPeriodoVersion = sv.Id
  INTO #SunatElectronicoRangoPeriodo   
FROM Financiero.ViewSunatElectronicoPeriodo AS vap (nolock)   
LEFT JOIN (   
  SELECT   
    Fila = ROW_NUMBER() OVER (PARTITION BY IdSunatElectronicoPeriodo ORDER BY NumeroProceso DESC)   
    , UbicacionArchivo = '/BACKOFFICE-DOCUMENTOS-WEB/' + UbicacionArchivo   
    , NumeroProceso, Archivo, IdSunatElectronicoPeriodo 
    , Id
  FROM Financiero.ViewSunatElectronicoPeriodoVersion   
  WHERE CodigoTipoProcesoSunatElectronico = 'DCL' AND SistemaOrigen = 'CONCAR'   
) as sv ON   
    sv.IdSunatElectronicoPeriodo = vap.Id AND Fila = 1   
WHERE vap.IdCompania = 32   
  AND vap.CodigoAnioPeriodo >= '201901'   
  AND vap.CodigoAnioPeriodo < '202407'   
  AND RIGHT(vap.CodigoAnioPeriodo,2) NOT IN ('00','13')   
  AND vap.CodigoSunatElectronico = '050100'   
ORDER BY vap.CodigoAnioPeriodo   
   


-- CURSORES   
DECLARE SunatElectronicoPeriodoVersion_Cursor CURSOR FOR   
SELECT Codigo = CodigoSunatElectronico, CodigoAnioPeriodo, Ubicacion, Archivo, IdSunatElectronicoPeriodoVersion FROM #SunatElectronicoRangoPeriodo   
   
-- OPEN CURSOR   
OPEN SunatElectronicoPeriodoVersion_Cursor   
FETCH NEXT FROM SunatElectronicoPeriodoVersion_Cursor into @Codigo, @CodigoAnioPeriodo, @Ubicacion, @Archivo, @IdSunatElectronicoPeriodoVersion   
WHILE @@fetch_status = 0   
BEGIN   
  DECLARE @CompaniaPeriodo VARCHAR(12);   

  --SELECT @Codigo, @CodigoAnioPeriodo, @Ubicacion, @Archivo, @IdSunatElectronicoPeriodoVersion
  EXEC [Financiero].[usp_cargarTxtSunatElectronicoPeriodoVersion] @IdSunatElectronicoPeriodoVersion, 'Admin', 'CONCAR' 
  FETCH NEXT FROM SunatElectronicoPeriodoVersion_Cursor into @Codigo, @CodigoAnioPeriodo, @Ubicacion, @Archivo, @IdSunatElectronicoPeriodoVersion;   
END 

CLOSE SunatElectronicoPeriodoVersion_Cursor;   
DEALLOCATE SunatElectronicoPeriodoVersion_Cursor;




[Financiero].[usp_cargarTxtSunatElectronicoPeriodoVersion]






























SELECT
  sa.idCompania
 --  Compania  
 --, Periodo  
 --, Libro  
 --, Moneda  
 --, Cuenta  
 --, DescripcionCuenta  
 --, RucCompania
 , cu.Codigo

  , INIdeb = IIF(si.SUMDeb - si.SUMHab > 0, si.SUMDeb - si.SUMHab, 0)
  , INIhab = IIF(si.SUMDeb - si.SUMHab < 0, si.SUMDeb - si.SUMHab, 0)

 , MOVdeb = mo.SUMDeb 
 , MOVhab = mo.SUMHab
 --, MESdeb  
 --, MEShab  
 	, SUMdeb = sa.SUMDeb
	, SUMhab = sa.SUMHab
  , FINdeb = IIF(sa.SUMDeb - sa.SUMHab > 0, sa.SUMDeb - sa.SUMHab, 0)
  , FINhab = IIF(sa.SUMDeb - sa.SUMHab < 0, sa.SUMDeb - sa.SUMHab, 0)
 ----, TRANATdeb  
 ----, TRANAThab  
 , ACT = CASE WHEN left(cu.Codigo,1) <= '5' THEN IIF(sa.SUMDeb - sa.SUMHab > 0, sa.SUMDeb - sa.SUMHab, 0) ELSE 0 END
 , PAS = CASE WHEN left(cu.Codigo,1) <= '5' THEN IIF(sa.SUMDeb - sa.SUMHab < 0, sa.SUMDeb - sa.SUMHab, 0) ELSE 0 END

 , PER = CASE WHEN left(cu.Codigo,1) >= '6' THEN IIF(sa.SUMDeb - sa.SUMHab > 0, sa.SUMDeb - sa.SUMHab, 0) ELSE 0 END
 , GAN = CASE WHEN left(cu.Codigo,1) >= '6' THEN IIF(sa.SUMDeb - sa.SUMHab < 0, sa.SUMDeb - sa.SUMHab, 0) ELSE 0 END

 , Saldo = sa.SUMDeb - sa.SUMHab

 --, IdCompania  
 --, IdAnio  
 --, IdAnioPeriodo  
 --, IdLibro  
 --, IdMoneda  
 --, IdCuenta  
  
 --, CuentaN1  
 --, CuentaN2  
 --, CuentaN3  
 --, CuentaN4  
 --, CuentaN5  
  
 --, CuentaDescripcionN1  
 --, CuentaDescripcionN2  
 --, CuentaDescripcionN3  
 --, CuentaDescripcionN4  
 --, CuentaDescripcionN5 



FROM (
  SELECT 
	  vld.idCompania
	  , vld.idCuenta
	  , vld.idLibro

	  , SUMDeb = SUM(DebeBase)
	  , SUMHab = SUM(HaberBase)

	  , SUMDebSis = SUM(DebeSistema)
	  , SUMHabSis = SUM(HaberSistema)

  FROM Financiero.ViewLoteDetalle AS vld
  WHERE vld.FechaContable <= '2018-11-28' AND CodigoCuenta = '121102'
  GROUP BY vld.idCompania, vld.idLibro, vld.idCuenta
) AS sa
LEFT JOIN (
  SELECT 
	  vld.idCompania
	  , vld.idCuenta
	  , vld.idLibro

	  , SUMDeb = SUM(DebeBase)
	  , SUMHab = SUM(HaberBase)

	  , SUMDebSis = SUM(DebeSistema)
	  , SUMHabSis = SUM(HaberSistema)

  FROM Financiero.ViewLoteDetalle AS vld
  WHERE vld.FechaContable < '2018-01-01' AND CodigoCuenta = '121102'
  GROUP BY vld.idCompania, vld.idLibro, vld.idCuenta
) AS si ON sa.idCompania = si.idCompania
  AND sa.idCuenta = si.idCuenta
  AND sa.idLibro = si.idLibro
LEFT JOIN (
  SELECT 
	  vld.idCompania
	  , vld.idCuenta
	  , vld.idLibro

	  , SUMDeb = SUM(DebeBase)
	  , SUMHab = SUM(HaberBase)

	  , SUMDebSis = SUM(DebeSistema)
	  , SUMHabSis = SUM(HaberSistema)

  FROM Financiero.ViewLoteDetalle AS vld
  WHERE vld.FechaContable >= '2018-01-01' AND vld.FechaContable <= '2018-11-28' AND CodigoCuenta = '121102'
  GROUP BY vld.idCompania, vld.idLibro, vld.idCuenta
) AS mo ON sa.idCompania = mo.idCompania
  AND sa.idCuenta = mo.idCuenta
  AND sa.idLibro = mo.idLibro

INNER JOIN Financiero.Cuenta AS cu ON sa.idCompania = cu.IdCompania
  AND sa.idCuenta = cu.Id

ORDER BY cu.Codigo