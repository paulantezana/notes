-------------------
# Sistema de ventas ZYBER primeros cambios
SQL
    ALTER TABLE mante_almacen ADD COLUMN ColorFondo VARCHAR(16);
    ALTER TABLE mante_almacen ADD COLUMN ColorTexto VARCHAR(16);
--> Procedure == mante_save_almacen

    DELIMITER $$

    USE `zayber`$$

    DROP PROCEDURE IF EXISTS `mante_save_almacen`$$

    CREATE DEFINER=`store_niko`@`localhost` PROCEDURE `mante_save_almacen`(`pId` INT(11), `pAlm` VARCHAR(150), `pSimbolo` VARCHAR(25), `pDescrip` VARCHAR(150), `pRuc` VARCHAR(50), `pRS` VARCHAR(200), `pDireccion` VARCHAR(150), `pColorFondo` VARCHAR(16), `pColorTexto` VARCHAR(16),   `pEstado` INT(1))
    BEGIN
        DECLARE cont INT(11);
        IF(pId>0)THEN
            UPDATE `mante_almacen` SET Almacen=pAlm,Simbolo=pSimbolo,Descripcion=pDescrip,Ruc=pRuc,RazonSocial=pRS,
                Direccion=pDireccion, `ColorFondo`=pColorFondo, `ColorTexto`=pColorTexto, `Estado`=pEstado
            WHERE IdAlmacen=pId;
        ELSE
            SELECT IFNULL(COUNT(*),0) INTO cont FROM `mante_almacen` WHERE Almacen=pAlm;
            IF(cont=0)THEN
                SELECT IFNULL(MAX(IdAlmacen+1),1) INTO pId FROM mante_almacen;
                INSERT INTO mante_almacen VALUES(pId,pAlm,pSimbolo,pEstado,pDescrip,pRuc,pRS,pDireccion,pColorFondo,pColorTexto);
            END IF;
        END IF;
        END$$

    DELIMITER ;

--> ALTER TABLE
    ALTER TABLE `mante_registro_nota_pedido` CHANGE `IdVenta` `IdVenta` INT(11) NOT NULL AUTO_INCREMENT;

Update
    -homeModel.php
    -homeController.php
    -panel_Html.js
    -ManteAlmacen.js
    -Mante.php
    -Procesos.php
    -RegistroVenta.js

-> Mejorar Sistema de ventas
    - Nota de pedido => Agregar nombre cliente.
                     => Manejo de stock
    - Venta rapida importar nota de pedido.
        -> ya no se permite modificar la cantidad **check*
        -> quitar el manejo del stock **ckeck**

        // if ($aIdProducto!='-1') {//en caso de que sea un producto que existe, ya que -1 indica producto no existente
        // 	$query1234="UPDATE `mante_producto_almacen` SET Stock=Stock-'".$aCantidad."'
        // 					WHERE IdAlmacen='".$aIdAlm."' AND IdProducto='".$aIdProducto."';";
        // 	$sql3 = $pdo->prepare($query1234);
        // 	if($sql3->execute()){
        // 		$queryGast="SELECT fn_save_kardex_Venta('".$IdUser."','".$pOrigen."','".$pDestino."','".$aIdAlm."',
        // 					'".$aIdProducto."','".addslashes($aDescripcion)."','".$aCantidad."','".$aPU."',
        // 					'".$aImporte."','".$IdTipoEnt."','".$aComprob."') as con;";
        // 		//echo $queryGast;
        // 		$sql4 = $pdo->prepare($queryGast);				
        // 		if($sql4->execute()){
        // 			$fila4=$sql4->fetchAll();
        // 			$valor=$fila4[0]["con"];
        // 			if($valor==1){$valido=true;}else{$valido=false;}
        // 		}
        // 	}else{$valido=false;}
        // }


    ALTER TABLE mante_registro_nota_pedido ADD COLUMN IdComprobante INT(3);    


proforma

-----------------------------------------------------------------------------------------------
# SISEMA RESTAURANT CAPON
- Numero de mozo => Nombre de mozo
# Cocina
- Otro layout
- Quitar header
- Quitar todo los items
- Reubicar (Logo - Zonas - LoginUser)
    - boton que indique atendido o servido
- Agregar sonido

- Interfaz cocina:
	* Lista de pedidos por atender (preparar)
	* Boton de agrandar orden                                       => Con icono de ZOOM Modal *****
	* Boton de marcar orden como atendida y quitar dicha orden      => Con icono de check verde *****
	* Interfaz actualizada automaticamente                          =>  *****
	* Ordenes listadas por hora de pedido                           => Dibujar por javascript segun la hora de la consulta (consulta por fecha) *****
	* Mosatrar observaciones o notas para cocina                    =>  *****



# SQL AJECUTADO

    ALTER TABLE atencion_clientes ADD COLUMN atendidoCocina TINYINT DEFAULT 0;
    ALTER TABLE detalle_ordens ADD COLUMN atendidoCocina TINYINT DEFAULT 0;

consulta atencion cliente.
    -detalles
    -mesa
    -ordenes

COCINA
    filtrar los nuevos
    atencion
    pintar con prefixId
        - se se encuentra pintar ijos
        - si no pintar todo

Atencion/interfas de atencion
- animacion inicial
- ganar mas espacio
- agregar como marcado por pedido
- orden inverso

233


# Sistema de Ventas Zyber
- la relacon empresa analizar para la facturacion * de momento esta de forma statica*
- Peticion de manuel
    Precio mayor = p.distribuidor
    Precio menor = p.publico

- en compra simple
    Tabla Alm-Pro = Tabla compra simple
    ----------------------------------
    precio mayor == precio distribuido  -- bien
    precio menor == precio base         -- analizar

## Observacion
- En nota de venta exonerado verificar  funcionalidad
- Revisar detalladamente VentaRapida Y nota de pedido

- STORE PROCEDURE MODIFICADO

===
textIdAlmacen_PVNP

$IdAlmacen
===

```sql
    DELIMITER $$

    USE `zayber`$$

    DROP PROCEDURE IF EXISTS `mante_save_almacen`$$

    CREATE DEFINER=`store_niko`@`localhost` PROCEDURE `mante_save_almacen`(`pId` INT(11), `pAlm` VARCHAR(150), `pSimbolo` VARCHAR(25), `pDescrip` VARCHAR(150), `pRuc` VARCHAR(50), `pRS` VARCHAR(200), `pDireccion` VARCHAR(150), `pColorFondo` VARCHAR(16), `pColorTexto` VARCHAR(16),   `pEstado` INT(1))
    BEGIN
    DECLARE cont INT(11);
    IF(pId>0)THEN
        UPDATE `mante_almacen` SET Almacen=pAlm,Simbolo=pSimbolo,Descripcion=pDescrip,Ruc=pRuc,RazonSocial=pRS,
        Direccion=pDireccion, `ColorFondo`=pColorFondo, `ColorTexto`=pColorTexto, `Estado`=pEstado
        WHERE IdAlmacen=pId;
    ELSE
        SELECT IFNULL(COUNT(*),0) INTO cont FROM `mante_almacen` WHERE Almacen=pAlm;
        IF(cont=0)THEN
        SELECT IFNULL(MAX(IdAlmacen+1),1) INTO pId FROM mante_almacen;
        INSERT INTO mante_almacen VALUES(pId,pAlm,pSimbolo,pEstado,pDescrip,pRuc,pRS,pDireccion,pColorFondo,pColorTexto);
        INSERT INTO mante_almacen_empresa VALUES(pId,1);
        END IF;
    END IF;
    END$$

    DELIMITER ;
```

```sql
    DELIMITER $$

    USE `zayber`$$

    DROP FUNCTION IF EXISTS `fn_Save_Productos_importP`$$

    CREATE DEFINER=`store_niko`@`localhost` FUNCTION `fn_Save_Productos_importP`(`pCod` VARCHAR(50), `pDescrip` VARCHAR(200), `pIdMarca` INT(5), `pIdModelo` INT(5), `pCompra` DOUBLE(11,2), `pMayor` DOUBLE(11,2), `pMenor` DOUBLE(11,2), `pPublico` DOUBLE(11,2), `pIdAlm` INT(3)) RETURNS int(2)
        READS SQL DATA
        DETERMINISTIC
    BEGIN
        DECLARE aCont INT(5);
        DECLARE aId INT(11);
        SET aCont=0;SET aId=1;
        
        SELECT IFNULL(COUNT(*),0) INTO aCont FROM `mante_producto` WHERE Codigo=pCod;
        IF(aCont>0)THEN
            SELECT IFNULL(IdProducto,0) INTO aId FROM `mante_producto` WHERE Codigo=pCod LIMIT 1;
            UPDATE `mante_producto` SET Producto=pDescrip,IdMarca=pIdMarca,IdCategoria=pIdModelo
            WHERE IdProducto=aId AND Codigo=pCod;
            SET aCont=0;
            SELECT IFNULL(COUNT(*),0) INTO  aCont FROM `mante_producto_almacen` WHERE IdAlmacen=pIdAlm AND IdProducto=aId;
            IF(aCont>0)THEN
                UPDATE `mante_producto_almacen` SET PrecioCompra=pCompra,PrecioBase=pMenor,PrecioDistribuido=pMayor,
                    PrecioPublico=pPublico
                WHERE IdAlmacen=pIdAlm AND IdProducto=aId;
            ELSE
                INSERT INTO mante_producto_almacen VALUES(pIdAlm,aId,1,1,0,pCompra,pMenor,pMayor,pPublico,1,1);
            END IF;
        ELSE
            SELECT IFNULL(MAX(IdProducto+1),1) INTO aId FROM `mante_producto`;
            INSERT INTO `mante_producto` VALUES(aId,pCod,pDescrip,pIdMarca,pIdModelo,1);
            INSERT INTO mante_producto_almacen VALUES(pIdAlm,aId,1,1,0,pCompra,pMenor,pMayor,pPublico,1,1);
        END IF;
            
        RETURN aId;
    END$$

    DELIMITER ;
```


# Hotel chaski Soporte
- Modifique la funcion para reenviar el comprobante (services/facturacion.php) Reenviar comprobante  linea 475 aproximadamente


# Modificaciones al sistema de minimarqet
- las mismas modificaciones que en el zayber para la importacion de stock desde un archivo excel.


# Modificaciones en el sistema Zayber
- Implementacion de facturacion electronica NUBEFACT.
- Control del stock mostrar detalles.

- Empresas
- Se modificao en almacenes
```sql
DELIMITER $$

USE `db_zayber`$$

DROP PROCEDURE IF EXISTS `mante_save_almacen`$$

CREATE  PROCEDURE `mante_save_almacen`(`pId` INT(11), `pAlm` VARCHAR(150), `pSimbolo` VARCHAR(25), `pDescrip` VARCHAR(150), `pRuc` VARCHAR(50), `pRS` VARCHAR(200), `pDireccion` VARCHAR(150), `pColorFondo` VARCHAR(16), `pColorTexto` VARCHAR(16),   `pEstado` INT(1), `pIdEmpresa` INT(11))
BEGIN
    DECLARE cont INT(11);
    IF(pId>0)THEN
        UPDATE `mante_almacen` SET Almacen=pAlm,Simbolo=pSimbolo,Descripcion=pDescrip,Ruc=pRuc,RazonSocial=pRS,
        Direccion=pDireccion, `ColorFondo`=pColorFondo, `ColorTexto`=pColorTexto, `Estado`=pEstado
        WHERE IdAlmacen=pId;        
	UPDATE `mante_almacen_empresa` SET `IdEmpresa` = pIdEmpresa WHERE IdAlmacen=pId;
    ELSE
        SELECT IFNULL(COUNT(*),0) INTO cont FROM `mante_almacen` WHERE Almacen=pAlm;
        IF(cont=0)THEN
        SELECT IFNULL(MAX(IdAlmacen+1),1) INTO pId FROM mante_almacen;
        INSERT INTO mante_almacen VALUES(pId,pAlm,pSimbolo,pEstado,pDescrip,pRuc,pRS,pDireccion,pColorFondo,pColorTexto);
        INSERT INTO mante_almacen_empresa VALUES(pId,pIdEmpresa);
        END IF;
    END IF;
    END$$

DELIMITER ;
```


Corregir en los detalles
```sql
ALTER TABLE `db_zayber`.`mante_registro_nota_pedido` ADD UNIQUE `idNotaPedidoUnique` (`IdNotaPedido`);

ALTER TABLE `mante_registro_nota_pedido_detalle` DROP INDEX `IdNotaPedidoDetalleUnique`;
ALTER TABLE `db_zayber`.`mante_registro_nota_pedido_detalle` ADD INDEX `IdNotaPedidoDetalleIndex` (`IdNotaPedido`);
```



# Teleredes
- Kiara mirian almeyda hancco
limpiar la base de datos

* 01-15 .

* Zayber examinar detenidamente y mejorar
- Nota de pedido


# Zayber
```sql
UPDATE mante_producto SET `Codigo` = REPLACE(`Codigo`,"'",'&#039;');
UPDATE mante_producto SET `Codigo` = REPLACE(`Codigo`,'"','&quot;');
```


Para consulta el correlativo que le toca
```SQL
SELECT IFNULL(MAX(Numero+1),1) AS aNumero FROM `mante_venta` 
	WHERE IdComprobante=1 AND Serie=1 AND IdEmpresa=2;
```


# Regularizacion de movimientos de almacen
Stock Insuficiente

58	SF271	FILTRO DE COMBUSTIBLE SF-271	UNIDAD	4.00	232.00								Se agrego


Not found

ANALIZAR A FONDO
12.00	742330087251.00	FILTRO SEPARADOR CAT. 1R0753 P551312	UNIDAD	0.00	0.00			No se agrego no era necesario => unico
12.00	742330087251.00	FILTRO SEPARADOR CAT. 1R0753 P551312	UNIDAD	0.00	0.00			No se agrego no era necesario => unico
12.00	742330087251.00	FILTRO SEPARADOR CAT. 1R0753 P551312	UNIDAD	0.00	0.00			No se agrego no era necesario => unico 28


** TABLA A REGULARIZAR **
12	742330044506.00	FILTRO DE ACEITE VOLVO (466634) P554004	UNIDAD	30.00	360.00
58	SF271			FILTRO DE COMBUSTIBLE SF-271	UNIDAD	4.00	232.00
25	SOF72466		FILTRO DE ACEITE (3001) SOF-7-2466	UNIDAD	7.00	175.00
12	9091510001.00	FILTRO DE ACEITE NEGRO TOYOTA 90915-10001 TF-3001N	UNIDAD	10.00	120.00
6	11M73			BATERIA 11M73	UNIDAD	260.00	1560.00
5	LF38			FILTRO DE ACEITE LF-38	UNIDAD	16.00	80.00
12	LF32			FILTRO DE ACEITE LF-32	UNIDAD	16.00	192.00
168	21400400450.00	ACEITE HELIX SN HX5 20W50	UNIDAD	20.00	3360.00
4	BAE2065			FILTRO DE AIRE BAE-2065	UNIDAD	45.00	180.00
4	310202610.00	HIDROLINA HYDROFLUID AW-68 X 5GLN	UNIDAD	140.00	560.00
3	13M87			BATERIA 13M87	UNIDAD	310.00	930.00
9	LF17356			FILTRO DE ACEITE LF17356	UNIDAD	54.00	486.00
5	LF3401			FILTRO DE ACEITE LF-3401	UNIDAD	18.00	90.00
6	742330137734.00	FILTRO DE COMBUSTIBLE VOLVO (20430751) P550529	UNIDAD	38.00	228.00
2	742330107744.00	FILTRO DE ACEITE BY PASS VOLVO (477556) P550425	UNIDAD	32.00	64.00
12	742330044506.00	FILTRO DE ACEITE VOLVO (466634) P554004	UNIDAD	30.00	360.00
12	742330087282.00	FILTRO DE COMBUSTIBLE CAT. DMX P551315	UNIDAD	42.00	504.00
2	742330112663.00	FILTRO DE AIRE 1Â°E P780519	UNIDAD	260.00	520.00
12	SOF72404		FILTRO DE ACEITE SOF-7-2404(LF80)	UNIDAD	8.00	96.00
3	SOF72125		FILTRO DE ACEITE SOF-7-2125(LF601)	UNIDAD	19.00	57.00
3	SOFZ2271		FILTRO DE ACEITE SOF-Z-2271(LF833)	UNIDAD	12.00	36.00
3	SOFZ2316		FILTRO DE ACEITE SOF-Z-2316(LF604)	UNIDAD	17.00	51.00
9	SF257			FILTRO DE COMBUSTIBLE SF-257	UNIDAD	4.00	36.00
4	MTF7P			BATERIA MTF-7P	UNIDAD	120.00	480.00
3	LF9				FILTRO DE ACEITE LF-9	UNIDAD	10.00	30.00
12	LF111			FILTRO DE ACEITE LF-111	UNIDAD	8.00	96.00
1	MT38			BATERIA MT38	UNIDAD	142.50	142.50
4	AFL3545HDR		FILTRO DE AIRE AFL-3545HDR	UNIDAD	75.00	300.00
2	8997879017869.00KIT DE FILTROS DE AIRE A-5541-S	UNIDAD	60.00	120.00
6	742330197462.00	FILTRO DE COMBUSTIBLE P550880	UNIDAD	60.00	360.00
5	742330043639.00	FILTRO DE ACEITE ROSCADO P551102	UNIDAD	57.00	285.00
2	742330194843.00	FILTRO SEPARADOR PERKINS 2650143 P551424	UNIDAD	62.00	124.00


# IMPORTANTE *
actualizar los detalles de la IdVenta 120 IdAlmacen -> Aun falta


- ANALISIS
							destino		// 		Origen								Destino  			Origen
>>>	SET con ids Antiguos     + 			// 		-		>> revertirlo 2				-					+
<<<							  					+		>> revertirlo 1									-

- SOLUCION
>>> Ejecutar el ubdate de reversion																	Listo			
>>>	buscar los productos que se movieron crear un update para ese productos que se movieron			Falta

Regularizar los productos que tuvieron sun set 0
>>>	Crear otro update para los que setearon a 0														Falta


# GUIA DE REMISION
```SQL
DROP TABLE IF EXISTS mante_motivo_traslado;
CREATE TABLE mante_motivo_traslado(
    codigo VARCHAR(2) NOT NULL,
    descripcion VARCHAR(255) NOT NULL,
    CONSTRAINT pk_mante_motivo_traslado PRIMARY KEY (codigo)
);

DROP TABLE IF EXISTS mante_ubicacion_geografica;
CREATE TABLE mante_ubicacion_geografica (
    codigo VARCHAR(6) NOT NULL,
    distrito VARCHAR(64) NOT NULL,
    provincia VARCHAR(64) NOT NULL,
    departamento VARCHAR(64) NOT NULL,
    CONSTRAINT pk_mante_ubicacion_geografica PRIMARY KEY (codigo)
);

DROP TABLE IF EXISTS mante_guia_remision;
CREATE TABLE mante_guia_remision(
    `IdGuiaRemision` INT AUTO_INCREMENT NOT NULL,
    `IdAlmacen` int(5) NOT NULL,
    `IdEmpresa` int(5) NOT NULL,
    `IdComprobante` int(3) DEFAULT NULL,
    `IdUsuario` int(11) DEFAULT NULL,
    `Serie` int(5) DEFAULT '-1',
    `Numero` int(11) DEFAULT '-1',
    `IdMotivoTraslado` INT,

    `Origen` VARCHAR(64) DEFAULT '', -- Mov. almacen, Venta, Compra.
    `NroFactura` varchar(50) DEFAULT NULL, -- Facturas que hace referencia

    `FechaReg` datetime DEFAULT NULL,
    `FechaEmision` datetime DEFAULT NULL,
    `FechaTraslado` DATETIME DEFAULT NULL,

    `DestinatarioRasonSocial` VARCHAR(64),
    `DestinatarioTipoDocumento` VARCHAR(64),
    `DestinatarioNumeroDocumento` VARCHAR(64),

    -- Transportista
    `TransportistaVehiculo` VARCHAR(64),
    `TransportistaMarca` VARCHAR(64),
    `TransportistaPlacaN` VARCHAR(64),
    `TransportistaCertificadoI` VARCHAR(64),
    `TransportistaLicenciaC` VARCHAR(64),
    
    `ConductorTipoDocumento` VARCHAR(24),
    `ConductorNumeroDocumento` VARCHAR(24),
    `ConductorNombreCompleto` VARCHAR(24),
    
    `PuntoPartidaCodigo` VARCHAR(6),
    `PuntoPartidaCodigoDireccion` VARCHAR(128),

    `PuntoLlegadaCodigo` VARCHAR(6),
    `PuntoLlegadaCodigoDireccion` VARCHAR(128),

    `Enlace` VARCHAR(200) DEFAULT NULL,
    `ErrorSunat` VARCHAR(250) DEFAULT NULL,

    `Estado` int(1) DEFAULT '1',

    CONSTRAINT pk_mante_guia_remision PRIMARY KEY (`IdGuiaRemision`)
);

DROP TABLE IF EXISTS mante_guia_remision_detalle;
CREATE TABLE mante_guia_remision_detalle(
    `IdGuiaRemisionDetalle` INT AUTO_INCREMENT NOT NULL,
    `IdGuiaRemision` int NOT NULL,
    `IdAlmacen` int(5) NOT NULL,
    `IdEmpresa` int(5) NOT NULL,

    `IdProducto` int(11) DEFAULT '-1',
    `Codigo` varchar(50) DEFAULT NULL,
    `Producto` VARCHAR(150) DEFAULT NULL,
    `Cantidad` double(11,3) DEFAULT '0.000',
    `Unidad` VARCHAR(50) DEFAULT NULL,
    `Peso` double(11,3) DEFAULT '0.000',

    CONSTRAINT pk_mante_guia_remision_detalle PRIMARY KEY (`IdGuiaRemisionDetalle`)
);
```

```sql
INSERT INTO `user_menu_sistema`(`IdForm`, `Enlace`, `Nombre`, `Estado`, `Nivel1`, `Nivel2`, `Menu`, `ColorFondo`, `ColorLetra`, `Permiso`, `Clase`, `Icono`) 
			VALUES ('216','index.php?action=RegistroGuiaRemision','Guia Remision','1','2','8','Registro','#FF7814','','1','claRsva','fas fa-atlas'),
			       ('217','index.php?action=ReporteGuiaRemision','R. Guia Remision','1','5','16','Registro','#FF7814','','1','claRsva','');
```

## Modificaciones archivos
- enlaces.php
## agregados
- RegistroGuiaRemision.php
- RegistroGuiaRemision.js

- ReporteGuiaRemision.php
- ReporteGuiaRemision.js